Vue.component("cashlist",{
  template:"#cash-template",
  data() {
    return {
      multipleSelection: [],
      total:0,
      currentPage:1,
      currentNum:100,
      list:[],
      loading:false,
    }
  },
  created:function(){
      let page = this.currentPage
      let num = this.currentNum
      this.loading = true
      let that = this
      this.getData(page,num,function (res) {
          let dt = res.data
          that.list = dt.list
          that.total = dt.total
      })
  },
  methods: {
    toggleSelection: function (rows) {
      if (rows) {
        rows.forEach(row => {
          this.$refs.multipleTable.toggleRowSelection(row);
        });
      } else {
        this.$refs.multipleTable.clearSelection();
      }
    },
    handleSelectionChange: function (val) {
      console.log(val)
      this.multipleSelection = val;
    },
    handleOrder: function (val) {
      console.log("filed=", val.prop)
      console.log("type=", val.order)


      this.loading = true
      setTimeout(() => {
        this.loading = false;
      }, 2000);
    },
    handleSizeChange(val) {
      console.log(`每页 ${val} 条`);
      this.currentNum = val
      this.loading = true
      let page = this.currentPage
      let that = this

      this.getData(page, val, function (res) {
        let dt = res.data
        if (dt.code == 200) {
          that.list = dt.list
          that.total = dt.total
        }
      })

    },
    handleCurrentChange(val) {
      console.log(`当前页: ${val}`);
      this.currentPage = val
      this.loading = true
      let num = this.currentNum
      let that = this

      this.getData(val, num, function (res) {
        let dt = res.data
        if (dt.code == 200) {
          that.list = dt.list
          that.total = dt.total
        }
      })
    },
    getData: function (page, num, callback) {
        let href = window.location.href
        let that = this
        axios.post(href, {
            page: page,
            num: num,
        }).then(function (res) {
            that.loading = false
            console.log(res)
            callback(res)
        }).catch(function (e) {
            that.loading = false
            that.$message({
                message: '加载数据失败',
                type: 'warning'
            });
        })
    },
    formatDate:function (tm) {
      let dt = moment(tm).format("YYYY-MM-DD HH:mm:ss")
      return dt
    },
    formatMoney:function (m) {
      let my = parseFloat(m/100).toFixed(2)
      return my
    },
    formatBool:function (s) {
      let m = s ? "是" : "否"
      return m
    },
    setName: function (d) {
        if(d == "one_url"){
            return "分享页域名";
        } else if (d == 'two_url') {
            return "入口域名1";
        } else if (d == 'three_url'){
            return "入口域名2";
        } else {
            return "";
        }
    },
    openA:function(d){
        let that = this
        this.$confirm('此操作将重启应用, 是否继续?', '提示', {
            confirmButtonText: '重启',
            cancelButtonText: '取消',
            type: 'warning',
            callback: action => {
               if(action == "confirm"){
                  that.resApp(d)
               }
            }
        })
    },
    resApp:function (d) {
        let that = this
        that.loading = true;
        let href = window.location.href.split("?") + "/resApp"
        axios.post(href, {appid:d.appid,project_id:d.project_id}).then(function (res) {
            console.log(res)
            that.loading = false;
            that.$message({
                message: '重启成功',
                type: 'success'
            });
            window.location.reload()
        }).catch(function (e) {
            that.loading = false
            console.log(e)
            that.$message({
                message: '重启失败',
                type: 'warning'
            });
        })
    }
  }
})


