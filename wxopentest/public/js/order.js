Vue.component("orderlist",{
  template:"#order-template",
  data() {
    return {
      acount:'',
      qrcode: '',
      checkList:[],
      multipleSelection: [],
      total:0,
      currentPage:1,
      currentNum:100,
      total2:0,
      currentPage2:1,
      currentNum2:100,
      dialogTitle:"",
      list:[],
      hostData:[
          {url_host:"qwer.safds.com",url_type:"one_url"},
          {url_host:"sadf.retyr.com",url_type:"two_url"},
          {url_host:"gdhg.bccvb.com",url_type:"three_url"},
          {url_host:"ret.vbncvb.com",url_type:"two_url"},
          {url_host:"kll.yuii.com",url_type:"one_url"}
      ],
      loading:false,
      formLabelWidth: '125px',
      dialogFormVisible: false,
      dialogForm2Visible: false,
      dialogForm6Visible: false,
      dialogForm5Visible: false,
      form: {
          number:'',
          passwd:'',
          appid:'',
          white_ip:"",
          wechat_id:"",
          white_acct:"",
          one_url:"",
          two_url:"",
          three_url:""
      },
      form2: {
          appid:"",
          wechat_id:"",
      },
      form3: {
          one_url:"",
          two_url:"",
          three_url:"",
      },
      form6: {
        appid:'',
        app_name: '',
        number:'',
        passwd:'',
      },
    }
  },
  created:function(){
      let page = this.currentPage
      let num = this.currentNum
      this.loading = true
      let that = this
      let a = document.querySelector("#order")
      this.acount = a.getAttribute("acount")
      this.getData(page,num,function (res) {
          let dt = res.data
          that.list = dt.list
          that.total = dt.total
          that.loading = false
      })
  },
  methods: {
    toggleSelection: function (rows) {
      if (rows) {
        rows.forEach(row => {
          this.$refs.multipleTable.toggleRowSelection(row);
        });
      } else {
        this.$refs.multipleTable.clearSelection();
      }
    },
    handleSelectionChange: function (val) {
      console.log(val)
      this.multipleSelection = val;
    },
    handleOrder: function (val) {
      console.log("filed=", val.prop)
      console.log("type=", val.order)


      this.loading = true
      setTimeout(() => {
        this.loading = false;
      }, 2000);
    },
    hostChange: function(val){
        console.log(val);
    },
    handleSizeChange: function(val) {
      console.log(`每页 ${val} 条`);
      this.currentNum = val
      this.loading = true
      let page = this.currentPage
      let that = this

      this.getData(page, val, function (res) {
        let dt = res.data
          that.list = dt.list
          that.total = dt.total
          that.loading = false
      })

    },
    handleCurrentChange(val) {
      console.log(`当前页: ${val}`);
      this.currentPage = val
      this.loading = true
      let num = this.currentNum
      let that = this

      this.getData(val, num, function (res) {
        let dt = res.data
          that.list = dt.list
          that.total = dt.total
          that.loading = false
      })
    },
    chkNum:function(d){
        let that = this
        this.loading = true
        let href = window.location.href.split("?")[0] + "/get_num"
        axios.post(href, d).then(function (res) {
            let dt = res.data
            that.loading = false
            if(dt.code == 0){
                that.$alert(dt.content, '提示', {
                    confirmButtonText: '确定',
                    callback: action => {}
                });
            }
        }).catch(function (e) {
            that.loading = false
            console.log(e)
        })
    },
    setImg:function(d){
        let h = '<img id="'+d.appid+'" src="/static/img/loading.gif" width="26"/>'
        return h;
    },
    getAcount:function(){
        return this.acount
    },
    getData: function (page, num, callback) {
      let that = this
      let href = window.location.href
      axios.post(href, {
        page: page,
        num: num,
      }).then(function (res) {
        console.log(res)
        callback(res)
      }).catch(function (e) {
          that.loading = false
          that.$message({
              message: '操作失败',
              type: 'warning'
          });
      })
    },
    getData2: function (page, num, callback) {
      let that = this
      let href = window.location.href.split("?")[0] + "/host_list"
      axios.post(href, {
          page: page,
          num: num,
      }).then(function (res) {
          console.log(res)
          callback(res)
      }).catch(function (e) {
          that.loading = false
          that.$message({
              message: '操作失败',
              type: 'warning'
          });
      })
    },
    mkText:function (d) {
      let that = this
      this.loading = true
      let href = window.location.href.split("?")[0] + "/mkText"
      axios.post(href,d).then(function (res) {
          let dt = res.data
          that.dialogForm2Visible = false
          that.loading = false
          that.$message({
              message: '生成Text文件成功',
              type: 'success'
          });
      }).catch(function (e) {
          that.loading = false
          that.$message({
              message: '生成Text文件失败',
              type: 'warning'
          });
      })
    },
    formText:function(a,b){
      return a + b;
    },
    closeOne:function(){
        this.tags.one = '';
    },
    closeTwo:function(){
      this.tags.two = '';
    },
    closeThree:function(){
      this.tags.three = '';
    },
    formatDate:function (tm) {
      let dt = moment(tm).format("YYYY-MM-DD HH:mm:ss")
      return dt
    },
    formatMoney:function (m) {
      let my = parseFloat(m/100).toFixed(2)
      return my
    },
    formatBool:function (s) {
      let m = s ? "是" : "否"
      return m
    },
    useTag:function(d){
        let that = this
        for (let k in this.form3){
            if(this.form[k] == d.url_host){

                that.$alert("域名已绑定其他位置类型，请先删除！", '操作失败', {
                    confirmButtonText: '确定',
                    callback: action => {
                        console.log(action)
                    }
                })

                return false
            }
        }

        switch (d.parsing_type) {
            case "one_url":
                this.form.one_url = d.url_host;
                that.$alert("已绑定为分享域名", '操作成功', {
                    confirmButtonText: '确定',
                    callback: action => {
                        console.log(action)
                    }
                })
                break;
            case "two_url":
                this.form.two_url = d.url_host;
                that.$alert("已绑定为入口域名1", '操作成功', {
                    confirmButtonText: '确定',
                    callback: action => {
                        console.log(action)
                    }
                })
                break;
            case "three_url":
                this.form.three_url = d.url_host;
                that.$alert("已绑定为入口域名2", '操作成功', {
                    confirmButtonText: '确定',
                    callback: action => {
                        console.log(action)
                    }
                })
                break;
            default:
                console.log("nothing");
        }
    },
    typeChange:function(d){
        console.log(d.url_type)
        console.log(d.url_host)
    },
    doHtml:function(d){
      let h = [
          '<div class="el-form-item">',
          '<label class="el-form-item__label">创建时间</label>',
          '<div class="el-form-item__content">',
          '<span>'+d.create_time+'</span>',
          '</div></div>',
          '<div class="el-form-item">',
          '<label class="el-form-item__label">APPID</label>',
          '<div class="el-form-item__content">',
          '<span>'+d.appid+'</span>',
          '</div></div>',
          '<div class="el-form-item">',
          '<label class="el-form-item__label">APPSECRET</label>',
          '<div class="el-form-item__content">',
          '<span>'+d.app_secret+'</span>',
          '</div></div>',
          '<div class="el-form-item">',
          '<label class="el-form-item__label">授权发起页域名</label>',
          '<div class="el-form-item__content">',
          '<span>'+d.back_host+'</span>',
          '</div></div>',
          '<div class="el-form-item">',
          '<label class="el-form-item__label">授权公众号</label>',
          '<div class="el-form-item__content">',
          '<span>'+d.wechat_id+'</span>',
          '</div></div>',
          '<div class="el-form-item">',
          '<label class="el-form-item__label">授权事件接收URL</label>',
          '<div class="el-form-item__content">',
          '<span>'+d.back_url+'</span>',
          '</div></div>',
          '<div class="el-form-item">',
          '<label class="el-form-item__label">消息校验Token</label>',
          '<div class="el-form-item__content">',
          '<span>'+d.msg_token+'</span>',
          '</div></div>',
          '<div class="el-form-item">',
          '<label class="el-form-item__label">消息加解密Key</label>',
          '<div class="el-form-item__content">',
          '<span>'+d.encodingAESKey+'</span>',
          '</div></div>',
          '<div class="el-form-item">',
          '<label class="el-form-item__label">分享页域名</label>',
          '<div class="el-form-item__content">',
          '<span>'+d.one_url+'</span>',
          '</div></div>',
          '<div class="el-form-item">',
          '<label class="el-form-item__label">入口页域名1</label>',
          '<div class="el-form-item__content">',
          '<span>'+d.two_url+'</span>',
          '</div></div>',
          '<div class="el-form-item">',
          '<label class="el-form-item__label">入口页域名2</label>',
          '<div class="el-form-item__content">',
          '<span>'+d.three_url+'</span>',
          '</div></div>',
      ].join('')
      return h;
    },
    goAuth: function (id) {
        let that = this
        let href = window.location.href.split("?")[0] + "/doHref"
        axios.post(href, {appid:id}).then(function (res) {
            console.log(res)
            let dt = res.data

            that.$alert('获取授权成功', '', {
                confirmButtonText: '前往授权',
                center: true,
                callback: action => {
                    if(action=="confirm") {
                        window.open(dt.url)
                    }
                }
            });

        }).catch(function (e) {
            that.$message({
                type: 'info',
                message: '获取授权失败'
            });
        })
    },
    postDate:function (d) {
        let that = this
        this.loading = true
        let href = window.location.href.split("?")[0] + "/doApp"
        axios.post(href,d).then(function (res) {
            let dt = res.data
            that.loading = false
            that.dialogFormVisible = false
            that.$message({
                message: '新建应用成功',
                type: 'success'
            });
            window.location.reload()
        }).catch(function (e) {
            that.loading = false
            that.dialogFormVisible = false
            that.$message({
                message: '新建应用失败',
                type: 'warning'
            });
        })
    },
   mdAcct:function(d){
       let that = this
       this.loading = true
       let href = window.location.href.split("?")[0] + "/mdAcct"
       axios.post(href,d).then(function (res) {
           let dt = res.data
           that.loading = false
           that.dialogForm2Visible = false
           if(dt.code == 0) {
               that.$confirm('应用公众号已修改成功', '提示', {
                   confirmButtonText: '确定',
                   cancelButtonText: '取消',
                   type: 'success',
                   callback: action => {
                       if (action == "confirm") {
                           window.location.reload()
                       }
                   }
               })
           } else {
               that.$message({
                   message: '应用公众号修改失败',
                   type: 'warning'
               });
           }
       }).catch(function (e) {
           that.loading = false
           that.dialogForm2Visible = false
           that.$message({
               message: '应用公众号修改失败',
               type: 'warning'
           });
       })
   },
   mdHost:function(d){
       let that = this
       this.loading = true
       let href = window.location.href.split("?")[0] + "/mdHost"
       axios.post(href,d).then(function (res) {
           let dt = res.data
           that.loading = false
           that.dialogForm5Visible = false
           if(dt.code == 0) {
               that.$confirm('应用域名已修改成功', '提示', {
                   confirmButtonText: '确定',
                   cancelButtonText: '取消',
                   type: 'success',
                   callback: action => {
                       if (action == "confirm") {
                           window.location.reload()
                       }
                   }
               })
           } else {
               that.$message({
                   message: '应用域名修改失败',
                   type: 'warning'
               });
           }

       }).catch(function (e) {
           that.loading = false
           that.dialogForm5Visible = false
           that.$message({
               message: '应用域名修改失败',
               type: 'warning'
           });
       })
   },
    chgStatu: function (d) {

        let that = this
        this.$confirm('此操作将永久删除该应用, 是否继续?', '提示', {
            confirmButtonText: '确定',
            cancelButtonText: '取消',
            type: 'warning',
            callback: action => {
                if(action == "confirm"){

                    that.loading = true
                    let href = window.location.href.split("?")[0] + "/chgstatu"
                    axios.post(href,{appid:d.appid,app_name: d.app_name}).then(function (res) {
                        let dt = res.data
                        that.loading = false
                        that.$message({
                            message: '应用已删除',
                            type: 'success'
                        });
                        window.location.reload()
                    }).catch(function (e) {
                        that.loading = false
                        that.$message({
                            message: '操作失败',
                            type: 'warning'
                        });
                    })

                }
            }
        })
    },
    chgSecret:function(d){

        let that = this
        this.form6.number = d.number
        this.form6.passwd = d.passwd
        this.form6.appid = d.appid
        this.form6.app_name = d.app_name

        this.loading = true

        let href = window.location.href.split("?")[0] + "/getQrcode"
        axios.post(href,this.form6).then(function (res) {
            let dt = res.data
            that.loading = false
            if(dt.code == 0) {
                that.qrcode = dt.img
                that.dialogForm6Visible = true;
            } else {
                that.$message({
                    message: '二维码获取失败',
                    type: 'warning'
                });
            }
        }).catch(function (e) {
            that.loading = false
            that.$message({
                message: '二维码获取失败',
                type: 'warning'
            });
        })

    },
    chgWechat:function (d) {
        let that = this
        this.form.white_ip = d.white_ip
        this.form.white_acct = d.wechat_id
        this.form.wechat_id = d.wechat_id
        this.form.one_url = d.one_url
        this.form.two_url = d.two_url
        this.form.three_url = d.three_url
        this.form.appid = d.appid

        this.dialogForm2Visible = true
    },
    chgHost:function (d) {
        let that = this
        this.loading = true
        this.dialogTitle = d.app_name
        this.dialogForm5Visible = true
        let page = this.currentPage2
        let num = this.currentNum2
        this.form.white_ip = d.white_ip
        this.form.white_acct = d.wechat_id
        this.form.wechat_id = d.wechat_id
        this.form.one_url = d.one_url
        this.form.two_url = d.two_url
        this.form.three_url = d.three_url
        this.form.appid = d.appid

        this.getData2(page,num,function (res) {
            let dt = res.data
            that.hostData = dt.list
            that.total2 = dt.total
            that.loading = false
        })
    },
    addDialog:function(){
        let that = this
        this.dialogFormVisible = true
        let page = this.currentPage2
        let num = this.currentNum2
        this.loading = true

        this.getData2(page,num,function (res) {
            let dt = res.data
            that.hostData = dt.list
            that.total2 = dt.total
            that.loading = false
        })
    },
    handleSizeChange2: function(val) {
      console.log(`每页 ${val} 条`);
      this.currentNum2 = val
      this.loading = true
      let page = this.currentPage2
      let that = this

      this.getData2(page, val, function (res) {
          let dt = res.data
          that.hostData = dt.list
          that.total2 = dt.total
          that.loading = false
      })

    },
    handleCurrentChange2(val) {
      console.log(`当前页: ${val}`);
      this.currentPage2 = val
      this.loading = true
      let num = this.currentNum2
      let that = this

      this.getData2(val, num, function (res) {
          let dt = res.data
          that.hostData = dt.list
          that.total2 = dt.total
          that.loading = false
      })
    },
    post3Date:function (d) {
        let that = this
        this.loading = true
        let href = window.location.href.split("?")[0] + "/chgwechat"
        axios.post(href,{appid:d.appid,wechat_id:d.wechat_id}).then(function (res) {
            let dt = res.data
            that.dialogForm2Visible = false
            that.loading = false
            that.$message({
                message: '公众号信息修改成功',
                type: 'success'
            });
            window.location.reload()
        }).catch(function (e) {
            that.loading = false
            that.$message({
                message: '操作失败',
                type: 'warning'
            });
        })
    },
    getQrcode:function(d){
        let that = this
        this.loading = true
        let href = window.location.href.split("?")[0] + "/getQrcode"
        axios.post(href,d).then(function (res) {
            let dt = res.data
            that.loading = false
            if(dt.code == 0) {
                that.qrcode = dt.img
                that.$message({
                    message: '二维码刷新成功',
                    type: 'success'
                });
            } else {
                that.$message({
                    message: '二维码刷新失败',
                    type: 'warning'
                });
            }
        }).catch(function (e) {
            that.loading = false
            that.$message({
                message: '二维码刷新失败',
                type: 'warning'
            });
        })
    },
    getSecret:function(d){
        let s = "secrect：" + d.app_secret;
        this.$alert(s, '应用Secrect', {
            confirmButtonText: '确定',
            callback: action => {
                console.log(action)
            }
        });
    },
    post6Date:function (d) {
      let that = this
      this.loading = true
      let href = window.location.href.split("?")[0] + "/doSecrect"
      axios.post(href,d).then(function (res) {
          let dt = res.data
          that.dialogForm6Visible = false
          that.loading = false
          if(dt.code == 0) {
              let s = "secrect：" + dt.secrect;
              that.$alert(s, '获取成功', {
                  confirmButtonText: '确定',
                  callback: action => {
                      if(action == "confirm"){
                          window.location.reload()
                      }
                  }
              });
          } else {
              that.$message({
                  message: '操作失败',
                  type: 'warning'
              });
          }
      }).catch(function (e) {
          that.loading = false
          that.$message({
              message: '操作失败',
              type: 'warning'
          });
      })
    },
  }
})


